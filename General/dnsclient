#!/bin/bash
#
# Script to  setup dns client on all LUIR VMs
# 
#

check() {
 echo "nsswitch.conf check"
 sed -n '/^host/p' /etc/nsswitch.conf 

 echo "resolv.conf check"
 cat /etc/resolv.conf    
}

nsswitchup() {
#update /etc/nsswitch.conf
sed -i.`date +%Y%m%d` 's/^hosts.*/hosts:   dns [!UNAVAIL=return] files/' /etc/nsswitch.conf
return
}

dfw3Resolvup() {
#update /etc/resolv.conf on dfw3
sed -i.`date +%Y%m%d` 's/^/\#/g' /etc/resolv.conf
echo "; generated by /sbin/dhclient-script" >> /etc/resolv.conf
echo "dfw3.local"
echo "nameserver 192.168.2.8" >> /etc/resolv.conf
echo "nameserver 192.168.2.9" >> /etc/resolv.conf
return 
}

sql1resolvup() {
#update /etc/resolv.conf on sql1
sed -i.`date +%Y%m%d` 's/^/\#/g' /etc/resolv.conf
echo "; generated by /sbin/dhclient-script" >> /etc/resolv.conf
echo "sql1.local"
echo "nameserver 192.168.1.7" >> /etc/resolv.conf
echo "nameserver 192.168.1.8" >> /etc/resolv.conf
return
}

fallback() {
cp  /etc/nsswitch.conf.`date +%Y%m%d`  /etc/nsswitch.conf
cp  /etc/resolv.conf.`date +%Y%m%d` /etc/resolv.conf
return
}

#
# MAIN program
#
IFS='
'
MENU="
Check DNS client setup  
Update nsswitch
Update resolv.conf in dfw3  
Update resolv.conf in sql1
Fallback change 
Exit/Stop
"
PS3='Select task:'
select m1 in $MENU
do
case $REPLY in
1) check;;
2) nsswitchup;;
3) dfw3Resolvup;;
4) sql1resolvup;;
5) fallback;;
6) exit 0 ;;
esac
done
